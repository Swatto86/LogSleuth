# LogSleuth Format Profile: Veeam Backup & Replication
#
# Covers VBR service logs (Svc.VeeamBackup.log, Svc.VeeamBroker.log, etc.)
# and job logs (Job.*.log). These all use the same bracketed format:
#
#   [23.11.2016 23:07:16] <01> Info     ------- Veeam Endpoint Job Started -------
#   [23.11.2016 23:07:16] <01> Error    Failed to connect to host 10.0.0.5
#
# Format: [DD.MM.YYYY HH:MM:SS] <ThreadID> Level     Message
#
# Log locations:
#   Windows: %ProgramData%\Veeam\Backup\
#   Linux:   /var/log/VeeamBackup/

[profile]
id = "veeam-vbr"
name = "Veeam Backup & Replication"
version = "1.0"
description = "VBR service and job logs (Svc.*.log, Job.*.log, Agent.*.log)"
log_locations = [
    "Windows: %ProgramData%\\Veeam\\Backup\\",
    "Linux: /var/log/VeeamBackup/",
]

[detection]
file_patterns = [
    # Service logs (Svc. prefix used by VBR service processes)
    "Svc.Veeam*.log",
    "Svc.Veeam*_[0-9]*.log",
    # Job logs
    "Job.*.log",
    "BackupCopy.*.log",
    # Agent and endpoint logs
    "Agent.*.log",
    "EP.*.log",
    "Endpoint.*.log",
    # WMI / infrastructure service logs present in every VBR installation
    "WmiServer.*.log",
    "WmiServer.log",
    # Named service logs
    "VeeamBackupManager.log",
    "VeeamPowerShell.log",
    "CatalogReplicationJob.log",
    "Veeam.WebApp.log",
    # Deployer / updater logs
    "VeeamDeployer*.log",
    # Mount service logs
    "Mount.*.log",
    # Catch-all for other top-level Veeam service logs whose names vary by version
    "Veeam*.log",
]
# Matches the opening bracket-timestamp pattern unique to VBR logs
content_match = '^\[\d{2}\.\d{2}\.\d{4}\s\d{2}:\d{2}:\d{2}\]\s<\d+>'

[parsing]
# Named groups: timestamp, thread, level, message
line_pattern = '^\[(?P<timestamp>\d{2}\.\d{2}\.\d{4}\s\d{2}:\d{2}:\d{2})\]\s<(?P<thread>\d+)>\s(?P<level>\w+)\s+(?P<message>.+)$'
timestamp_format = "%d.%m.%Y %H:%M:%S"
multiline_mode = "continuation"

[severity_mapping]
critical = ["Critical", "Fatal"]
error = ["Error"]
warning = ["Warning", "Warn"]
info = ["Info", "Success"]
debug = ["Debug", "Verbose", "Trace"]

# Regex-based second-chance classification applied when the captured level
# string is not in severity_mapping (e.g. vendor-specific tokens) or for
# continuation lines that become plain message text.
[severity_override]
critical = ['\bFATAL\b', '\bCRITICAL\b']
error    = ['\bFailed\b', '\bException\b', '\bError\b', 'Unable to', 'Cannot ']
warning  = ['\bWarn(ing)?\b', '\bTimeout\b', '\bRetry\b']
info     = ['\bSucceed\b', '\bCompleted\b']
